<% set_page_title(@form.name) %>

<% content_for :back_link, govuk_back_link_to(form_path(@form), "Back to create a form") %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <% if @form.live? %>
      <%= render LiveFormWarningComponent::View.new() %>
    <% end %>

    <h1 class="govuk-heading-l govuk-!-margin-bottom-2">
      <span class="govuk-caption-l"><%= @form.name %></span><span class="govuk-visually-hidden"> - </span>
      <%= t("pages.index.title") %>
    </h1>
    <dl class="govuk-!-margin-bottom-7">
      <dt class="govuk-visually-hidden">Status</dt>
      <dd class="govuk-!-margin-0"><%= render FormStatusTagComponent::View.new(status: @form.status) %></dd>
    </dl>

    <% if flash[:message] %>
      <p class="govuk-body"><%= flash[:message] %></p>
    <% end %>
    <div class="govuk-button-group">
      <%= govuk_button_link_to t("pages.index.add_question"), new_page_path(@form), class:"govuk-!-margin-bottom-3 govuk-!-margin-top-3" %>
      <%= render PreviewLinkComponent::View.new(@pages, link_to_runner(ENV["RUNNER_BASE"], @form.id, @form.form_slug)) %>
    </div>

    <% if @pages.any? %>
      <%= form_with url: down_page_url, method: :post do |f| %>
      <h2 class="govuk-heading-m govuk-!-margin-top-7 govuk-!-margin-bottom-0"><%= t("forms.form_overview.your_questions") %></h2>
      <% @pages.each_with_index do |page, index| %>
        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
              <%= question_text_with_optional_suffix(page) %>
            </dt>
            <dd class="govuk-summary-list__actions">
            <div class="govuk-button-group form-action-group govuk-!-margin-bottom-0">
              <% if index != 0 %>
                <%= f.govuk_submit "Move up" , secondary: true, name: 'page_id', value: @pages[index - 1].id %>
              <% end %>
              <% if index != @pages.length - 1 %>
                <%= f.govuk_submit "Move down" , secondary: true, name: 'page_id', value: page.id %>
              <% end %>
            </div>
              <%= govuk_link_to edit_page_path(@form,page) do %>
                <%= t("forms.form_overview.edit") %> <span class="govuk-visually-hidden"><%= page.question_text %></span>
              <% end %>
            </dd>
          </div>
        </dl>
      <% end %>
    <% end %>

      <% if @pages.any? %>
        <%= render MarkCompleteComponent::View.new(form_model: @mark_complete_form, path: form_pages_path(@form), legend: t("pages.index.mark_complete.legend")) %>
      <% end %>
    <% end %>

  </div>
</div>
